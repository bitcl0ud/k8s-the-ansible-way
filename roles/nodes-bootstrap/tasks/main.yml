---
  - name: Disabling SELinux
    selinux:
      policy: targeted
      state: permissive
    register: selinux

  - name: Reboot (if required)
    shell: sleep 2 && shutdown -r now 'Reboot required' removes=/var/run/reboot-required
    become: true
    async: 1
    poll: 0
    ignore_errors: true
    when: selinux.changed

  - name: Wait for reboot
    local_action: wait_for host={{ ansible_hostname }} port=22 delay=10 state=started
    when: selinux.changed

  - name: Installing `ntpd` for clock sync
    package:
      name: ntp
      state: present
  
  - name: Syncing clock
    shell: |
      ntpdate -u pool.ntp.org
  
  - name: Enabling NTPD service  
    systemd:
      name: ntpd
      enabled: yes
      state: restarted
